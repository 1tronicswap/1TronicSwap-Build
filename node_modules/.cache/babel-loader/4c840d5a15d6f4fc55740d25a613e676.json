{"ast":null,"code":"/* eslint-disable no-param-reassign */\nimport { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { LotteryStatus } from 'config/constants/types';\nimport { fetchLottery, fetchCurrentLotteryIdAndMaxBuy, fetchTickets } from './helpers';\nimport getLotteriesData from './getLotteriesData';\nimport getUserLotteryData from './getUserLotteryData';\nconst initialState = {\n  currentLotteryId: null,\n  isTransitioning: false,\n  maxNumberTicketsPerBuyOrClaim: null,\n  currentRound: {\n    isLoading: true,\n    lotteryId: null,\n    status: LotteryStatus.PENDING,\n    startTime: '',\n    endTime: '',\n    priceTicketInCake: '',\n    discountDivisor: '',\n    treasuryFee: '',\n    firstTicketId: '',\n    lastTicketId: '',\n    amountCollectedInCake: '',\n    finalNumber: null,\n    cakePerBracket: [],\n    countWinnersPerBracket: [],\n    rewardsBreakdown: [],\n    userTickets: {\n      isLoading: true,\n      tickets: []\n    }\n  },\n  lotteriesData: null,\n  userLotteryData: {\n    account: '',\n    totalCake: '',\n    totalTickets: '',\n    rounds: []\n  }\n};\nexport const fetchCurrentLottery = createAsyncThunk('lottery/fetchCurrentLottery', async _ref => {\n  let {\n    currentLotteryId\n  } = _ref;\n  const lotteryInfo = await fetchLottery(currentLotteryId);\n  return lotteryInfo;\n});\nexport const fetchCurrentLotteryId = createAsyncThunk('lottery/fetchCurrentLotteryId', async () => {\n  const currentIdAndMaxBuy = await fetchCurrentLotteryIdAndMaxBuy();\n  return currentIdAndMaxBuy;\n});\nexport const fetchUserTicketsAndLotteries = createAsyncThunk('lottery/fetchUserTicketsAndLotteries', async _ref2 => {\n  var _userLotteriesRes$rou;\n\n  let {\n    account,\n    currentLotteryId\n  } = _ref2;\n  const userLotteriesRes = await getUserLotteryData(account, currentLotteryId);\n  const userParticipationInCurrentRound = (_userLotteriesRes$rou = userLotteriesRes.rounds) === null || _userLotteriesRes$rou === void 0 ? void 0 : _userLotteriesRes$rou.find(round => round.lotteryId === currentLotteryId);\n  const totalTickets = (userParticipationInCurrentRound === null || userParticipationInCurrentRound === void 0 ? void 0 : userParticipationInCurrentRound.totalTickets) || '0'; // Get user tickets for current round\n  // TODO: This can come from the getUserLotteryData function instead\n\n  const userTickets = await fetchTickets(account, currentLotteryId, totalTickets); // user has not bought tickets for the current lottery\n\n  if (!userTickets || userTickets.length === 0) {\n    return {\n      userTickets: null,\n      userLotteries: userLotteriesRes\n    };\n  }\n\n  return {\n    userTickets,\n    userLotteries: userLotteriesRes\n  };\n});\nexport const fetchPublicLotteries = createAsyncThunk('lottery/fetchPublicLotteries', async _ref3 => {\n  let {\n    currentLotteryId\n  } = _ref3;\n  const lotteries = await getLotteriesData(currentLotteryId);\n  return lotteries;\n});\nexport const fetchUserLotteries = createAsyncThunk('lottery/fetchUserLotteries', async _ref4 => {\n  let {\n    account,\n    currentLotteryId\n  } = _ref4;\n  const userLotteries = await getUserLotteryData(account, currentLotteryId);\n  return userLotteries;\n});\nexport const setLotteryIsTransitioning = createAsyncThunk(`lottery/setIsTransitioning`, async _ref5 => {\n  let {\n    isTransitioning\n  } = _ref5;\n  return {\n    isTransitioning\n  };\n});\nexport const LotterySlice = createSlice({\n  name: 'Lottery',\n  initialState,\n  reducers: {\n    setLotteryPublicData: (state, action) => {\n      state = action.payload;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchCurrentLottery.fulfilled, (state, action) => {\n      state.currentRound = { ...state.currentRound,\n        ...action.payload\n      };\n    });\n    builder.addCase(fetchCurrentLotteryId.fulfilled, (state, action) => {\n      state.currentLotteryId = action.payload.currentLotteryId;\n      state.maxNumberTicketsPerBuyOrClaim = action.payload.maxNumberTicketsPerBuyOrClaim;\n    });\n    builder.addCase(fetchUserTicketsAndLotteries.fulfilled, (state, action) => {\n      state.currentRound.userTickets.isLoading = false;\n      state.currentRound.userTickets.tickets = action.payload.userTickets;\n      state.userLotteryData = action.payload.userLotteries;\n    });\n    builder.addCase(fetchPublicLotteries.fulfilled, (state, action) => {\n      state.lotteriesData = action.payload;\n    });\n    builder.addCase(fetchUserLotteries.fulfilled, (state, action) => {\n      state.userLotteryData = action.payload;\n    });\n    builder.addCase(setLotteryIsTransitioning.fulfilled, (state, action) => {\n      state.isTransitioning = action.payload.isTransitioning;\n    });\n  }\n}); // Actions\n\nexport const {\n  setLotteryPublicData\n} = LotterySlice.actions;\nexport default LotterySlice.reducer;","map":{"version":3,"sources":["D:/new/1TronicSwap-Build/src/state/lottery/index.ts"],"names":["createAsyncThunk","createSlice","LotteryStatus","fetchLottery","fetchCurrentLotteryIdAndMaxBuy","fetchTickets","getLotteriesData","getUserLotteryData","initialState","currentLotteryId","isTransitioning","maxNumberTicketsPerBuyOrClaim","currentRound","isLoading","lotteryId","status","PENDING","startTime","endTime","priceTicketInCake","discountDivisor","treasuryFee","firstTicketId","lastTicketId","amountCollectedInCake","finalNumber","cakePerBracket","countWinnersPerBracket","rewardsBreakdown","userTickets","tickets","lotteriesData","userLotteryData","account","totalCake","totalTickets","rounds","fetchCurrentLottery","lotteryInfo","fetchCurrentLotteryId","currentIdAndMaxBuy","fetchUserTicketsAndLotteries","userLotteriesRes","userParticipationInCurrentRound","find","round","length","userLotteries","fetchPublicLotteries","lotteries","fetchUserLotteries","setLotteryIsTransitioning","LotterySlice","name","reducers","setLotteryPublicData","state","action","payload","extraReducers","builder","addCase","fulfilled","actions","reducer"],"mappings":"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","sourcesContent":["/* eslint-disable no-param-reassign */\r\nimport { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\r\nimport { LotteryTicket, LotteryStatus } from 'config/constants/types'\r\nimport { LotteryState, LotteryRoundGraphEntity, LotteryUserGraphEntity, LotteryResponse } from 'state/types'\r\nimport { fetchLottery, fetchCurrentLotteryIdAndMaxBuy, fetchTickets } from './helpers'\r\nimport getLotteriesData from './getLotteriesData'\r\nimport getUserLotteryData from './getUserLotteryData'\r\n\r\ninterface PublicLotteryData {\r\n  currentLotteryId: string\r\n  maxNumberTicketsPerBuyOrClaim: string\r\n}\r\n\r\nconst initialState: LotteryState = {\r\n  currentLotteryId: null,\r\n  isTransitioning: false,\r\n  maxNumberTicketsPerBuyOrClaim: null,\r\n  currentRound: {\r\n    isLoading: true,\r\n    lotteryId: null,\r\n    status: LotteryStatus.PENDING,\r\n    startTime: '',\r\n    endTime: '',\r\n    priceTicketInCake: '',\r\n    discountDivisor: '',\r\n    treasuryFee: '',\r\n    firstTicketId: '',\r\n    lastTicketId: '',\r\n    amountCollectedInCake: '',\r\n    finalNumber: null,\r\n    cakePerBracket: [],\r\n    countWinnersPerBracket: [],\r\n    rewardsBreakdown: [],\r\n    userTickets: {\r\n      isLoading: true,\r\n      tickets: [],\r\n    },\r\n  },\r\n  lotteriesData: null,\r\n  userLotteryData: { account: '', totalCake: '', totalTickets: '', rounds: [] },\r\n}\r\n\r\nexport const fetchCurrentLottery = createAsyncThunk<LotteryResponse, { currentLotteryId: string }>(\r\n  'lottery/fetchCurrentLottery',\r\n  async ({ currentLotteryId }) => {\r\n    const lotteryInfo = await fetchLottery(currentLotteryId)\r\n    return lotteryInfo\r\n  },\r\n)\r\n\r\nexport const fetchCurrentLotteryId = createAsyncThunk<PublicLotteryData>('lottery/fetchCurrentLotteryId', async () => {\r\n  const currentIdAndMaxBuy = await fetchCurrentLotteryIdAndMaxBuy()\r\n  return currentIdAndMaxBuy\r\n})\r\n\r\nexport const fetchUserTicketsAndLotteries = createAsyncThunk<\r\n  { userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity },\r\n  { account: string; currentLotteryId: string }\r\n>('lottery/fetchUserTicketsAndLotteries', async ({ account, currentLotteryId }) => {\r\n  const userLotteriesRes = await getUserLotteryData(account, currentLotteryId)\r\n  const userParticipationInCurrentRound = userLotteriesRes.rounds?.find((round) => round.lotteryId === currentLotteryId)\r\n\r\n  const totalTickets = userParticipationInCurrentRound?.totalTickets || '0'\r\n  // Get user tickets for current round\r\n  // TODO: This can come from the getUserLotteryData function instead\r\n  const userTickets = await fetchTickets(account, currentLotteryId, totalTickets)\r\n\r\n  // user has not bought tickets for the current lottery\r\n  if (!userTickets || userTickets.length === 0) {\r\n    return { userTickets: null, userLotteries: userLotteriesRes }\r\n  }\r\n\r\n  return { userTickets, userLotteries: userLotteriesRes }\r\n})\r\n\r\nexport const fetchPublicLotteries = createAsyncThunk<LotteryRoundGraphEntity[], { currentLotteryId: string }>(\r\n  'lottery/fetchPublicLotteries',\r\n  async ({ currentLotteryId }) => {\r\n    const lotteries = await getLotteriesData(currentLotteryId)\r\n    return lotteries\r\n  },\r\n)\r\n\r\nexport const fetchUserLotteries = createAsyncThunk<\r\n  LotteryUserGraphEntity,\r\n  { account: string; currentLotteryId: string }\r\n>('lottery/fetchUserLotteries', async ({ account, currentLotteryId }) => {\r\n  const userLotteries = await getUserLotteryData(account, currentLotteryId)\r\n  return userLotteries\r\n})\r\n\r\nexport const setLotteryIsTransitioning = createAsyncThunk<{ isTransitioning: boolean }, { isTransitioning: boolean }>(\r\n  `lottery/setIsTransitioning`,\r\n  async ({ isTransitioning }) => {\r\n    return { isTransitioning }\r\n  },\r\n)\r\n\r\nexport const LotterySlice = createSlice({\r\n  name: 'Lottery',\r\n  initialState,\r\n  reducers: {\r\n    setLotteryPublicData: (state, action) => {\r\n      state = action.payload\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder.addCase(fetchCurrentLottery.fulfilled, (state, action: PayloadAction<LotteryResponse>) => {\r\n      state.currentRound = { ...state.currentRound, ...action.payload }\r\n    })\r\n    builder.addCase(fetchCurrentLotteryId.fulfilled, (state, action: PayloadAction<PublicLotteryData>) => {\r\n      state.currentLotteryId = action.payload.currentLotteryId\r\n      state.maxNumberTicketsPerBuyOrClaim = action.payload.maxNumberTicketsPerBuyOrClaim\r\n    })\r\n    builder.addCase(\r\n      fetchUserTicketsAndLotteries.fulfilled,\r\n      (state, action: PayloadAction<{ userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity }>) => {\r\n        state.currentRound.userTickets.isLoading = false\r\n        state.currentRound.userTickets.tickets = action.payload.userTickets\r\n        state.userLotteryData = action.payload.userLotteries\r\n      },\r\n    )\r\n    builder.addCase(fetchPublicLotteries.fulfilled, (state, action: PayloadAction<LotteryRoundGraphEntity[]>) => {\r\n      state.lotteriesData = action.payload\r\n    })\r\n    builder.addCase(fetchUserLotteries.fulfilled, (state, action: PayloadAction<LotteryUserGraphEntity>) => {\r\n      state.userLotteryData = action.payload\r\n    })\r\n    builder.addCase(\r\n      setLotteryIsTransitioning.fulfilled,\r\n      (state, action: PayloadAction<{ isTransitioning: boolean }>) => {\r\n        state.isTransitioning = action.payload.isTransitioning\r\n      },\r\n    )\r\n  },\r\n})\r\n\r\n// Actions\r\nexport const { setLotteryPublicData } = LotterySlice.actions\r\n\r\nexport default LotterySlice.reducer\r\n"]},"metadata":{},"sourceType":"module"}